<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- rss auto-discovery https://www.rssboard.org/rss-autodiscovery -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://conorsheehan1.github.io/feed.xml">

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Reverse Engineering Uhabits Datamodel | Conor Sheehan</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Reverse Engineering Uhabits Datamodel" />
<meta name="author" content="ConorSheehan1" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="OK, that title sounds fancy and complicated. What did I actually do? First I should probably explain why I did anything in the first place." />
<meta property="og:description" content="OK, that title sounds fancy and complicated. What did I actually do? First I should probably explain why I did anything in the first place." />
<link rel="canonical" href="https://conorsheehan1.github.io/blog/2022/04/18/reverse-engineering-uhabits-datamodel.html" />
<meta property="og:url" content="https://conorsheehan1.github.io/blog/2022/04/18/reverse-engineering-uhabits-datamodel.html" />
<meta property="og:site_name" content="Conor Sheehan" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-04-18T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Reverse Engineering Uhabits Datamodel" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ConorSheehan1"},"dateModified":"2022-04-18T00:00:00+00:00","datePublished":"2022-04-18T00:00:00+00:00","description":"OK, that title sounds fancy and complicated. What did I actually do? First I should probably explain why I did anything in the first place.","headline":"Reverse Engineering Uhabits Datamodel","mainEntityOfPage":{"@type":"WebPage","@id":"https://conorsheehan1.github.io/blog/2022/04/18/reverse-engineering-uhabits-datamodel.html"},"url":"https://conorsheehan1.github.io/blog/2022/04/18/reverse-engineering-uhabits-datamodel.html"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="https://conorsheehan1.github.io/assets/dist/jstree/themes/default/style.min.css" />
    <link rel="stylesheet" href="https://conorsheehan1.github.io/assets/dist/jstree/themes/default-dark/style.min.css" />
    <link href="https://conorsheehan1.github.io/assets/dist/lightbox/css/lightbox.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->

    <link rel="stylesheet" href="https://conorsheehan1.github.io/assets/dist/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="https://conorsheehan1.github.io/assets/css/style.css?v=">
    <link rel="shortcut icon" type="image/x-ico" href="https://conorsheehan1.github.io/assets/images/icons/favicon.ico" >

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <script src="https://conorsheehan1.github.io/assets/dist/lightbox/js/lightbox.min.js"></script>
    <!-- order matters here. e.g. jstree depends on theme being loaded to provied getSavedTheme -->
    <script src="https://conorsheehan1.github.io/assets/js/theme.js"></script>
    <script src="https://conorsheehan1.github.io/assets/js/lightbox_custom.js"></script>
    <script src="https://conorsheehan1.github.io/assets/js/jstree_custom.js"></script>

  </head>
  <body>
    <div class="wrapper">
      <header id="header">
  <div class="container">
      <div class="col">
        <a href="https://github.com/ConorSheehan1">
          <div class="header-icon">
            <img src="https://conorsheehan1.github.io/assets/images/icons/github.svg" alt="github" />
          </div>
          <span>GitHub</span>
        </a>
      </div>

      <div class="col">
        <a href="https://www.linkedin.com/in/conor-s-403358106">
          <div class="header-icon">
            <img src="https://conorsheehan1.github.io/assets/images/icons/linkedin.svg" alt="linkedin" />
          </div>
          <span>Linked In</span>
        </a>
      </div>

      <div class="col">
        <a href="https://stackoverflow.com/users/6305204/con?tab=profile">
          <div class="header-icon">
            <img src="https://conorsheehan1.github.io/assets/images/icons/stackoverflow.svg" alt="stackoverflow" />
          </div>
          <span>Stack Overflow</span>
        </a>
      </div>

      <div class="col" id="theme-toggle-container">
        <div id="theme-toggle-background">
          <a id="theme-toggle" title="Switch Theme">
            <i class="fa-solid fa-adjust icon-size" aria-hidden="true" size="32px"></i>
          </a>
        </div>
      </div>
  </div>
  <div class="container-sm">
    <div class="header-center">
  <input id="projects-search-input" type="text" class="form-control header-left" placeholder="Search projects ..">
  <div id="projects-tree" class="header-right">
    <ul>
      <li data-jstree='{ "opened" : false }'>
        <a class='clickable-tree-node' href="/projects">Projects</a>
        <ul>
          
          
            
            
            <li>
              <a class='clickable-tree-node' href="https://conorsheehan1.github.io/categories#blog">
                Blog
              </a>
              <ul>
                
                
                  <li><a class='clickable-tree-node' href="/blog/2024/03/07/leaving-netlify-free-tier.html">Leaving Netlify Free Tier</a></li>
                
                  <li><a class='clickable-tree-node' href="/blog/2023/07/01/archiving-youtube-timestamp-reddit-bot.html">Archiving Youtube Timestamp Reddit Bot</a></li>
                
                  <li><a class='clickable-tree-node' href="/blog/2022/08/04/buying-and-configuring-my-first-domain.html">Buying And Configuring My First Domain</a></li>
                
                  <li><a class='clickable-tree-node' href="/blog/2022/04/18/reverse-engineering-uhabits-datamodel.html">Reverse Engineering Uhabits Datamodel</a></li>
                
                  <li><a class='clickable-tree-node' href="/blog/2022/03/31/stackoverflow-dev-story-sunset.html">Stackoverflow Dev Story Sunset</a></li>
                
                  <li><a class='clickable-tree-node' href="/blog/2022/02/21/netlify-deployments-from-github-without-giving-write-access.html">Netlify Deployments From Github Without Giving Write Access</a></li>
                
                  <li><a class='clickable-tree-node' href="/blog/2022/01/25/add-bootstrap-vue-to-vuepress.html">Add Bootstrap Vue To Vuepress</a></li>
                
                  <li><a class='clickable-tree-node' href="/blog/2022/01/07/3-patterns-for-cookiecutter-templates.html">3 Patterns For Cookiecutter Templates</a></li>
                
                  <li><a class='clickable-tree-node' href="/blog/2022/01/06/dev.to.html">Dev.to</a></li>
                
              </ul>
            </li>
          
            
            
            <li>
              <a class='clickable-tree-node' href="https://conorsheehan1.github.io/categories#college">
                College
              </a>
              <ul>
                
                
                  <li><a class='clickable-tree-node' href="/college/2016/08/31/dublin-bikes.html">Dublin Bikes</a></li>
                
                  <li><a class='clickable-tree-node' href="/college/2016/07/21/restimator.html">Restimator</a></li>
                
              </ul>
            </li>
          
            
            
            <li>
              <a class='clickable-tree-node' href="https://conorsheehan1.github.io/categories#open_source">
                Open source
              </a>
              <ul>
                
                
                  <li><a class='clickable-tree-node' href="/open_source/2018/05/28/vufind.html">Vufind</a></li>
                
              </ul>
            </li>
          
            
            
            <li>
              <a class='clickable-tree-node' href="https://conorsheehan1.github.io/categories#personal">
                Personal
              </a>
              <ul>
                
                
                  <li><a class='clickable-tree-node' href="/personal/2022/09/08/jekyll-plugins-on-github-pages.html">Jekyll Plugins On Github Pages</a></li>
                
                  <li><a class='clickable-tree-node' href="/personal/2021/09/16/youtube-timestamp-reddit-bot.html">Youtube Timestamp Reddit Bot</a></li>
                
                  <li><a class='clickable-tree-node' href="/personal/2020/12/03/shot.html">Shot</a></li>
                
                  <li><a class='clickable-tree-node' href="/personal/2020/09/21/osxdocker.html">Osxdocker</a></li>
                
                  <li><a class='clickable-tree-node' href="/personal/2018/01/27/chrome-compare.html">Chrome Compare</a></li>
                
              </ul>
            </li>
          
        </ul>
      </li>
    </ul>
  </div>
</div>

  </div>
</header>

      <section>
        <div id="title">
          <h1><a href="/">Conor Sheehan</a></h1>
          <hr>
        </div>
        <h1>Reverse Engineering Uhabits Datamodel
  <span class="back-to-projects">
    <a href="https://conorsheehan1.github.io/projects">&larr; Back to projects</a>
  </span>
</h1>
<div>
  <div class='category-badge'>
    Categories:
    <span class="badge">
      
        
        <span class="badge">
          <a href="https://conorsheehan1.github.io/categories#blog">blog</a>
        </span>
      
    </span>
  </div>
  
  <div class='tag-badge'>Tags:
    
      
      <span class="badge">
        <a href="https://conorsheehan1.github.io/tag/devto">devto</a>
      </span>
    
  </div>
  
</div>
<hr></hr>



<p>OK, that title sounds fancy and complicated. What did I actually do?
First I should probably explain why I did anything in the first place.</p>

<h3 id="background">Background</h3>
<p>I’ve been using <a href="https://github.com/iSoron/uhabits">uhabits</a> for years. I noticed a new <a href="https://github.com/iSoron/uhabits/discussions/42">numeric habit type</a> was added in <a href="https://github.com/iSoron/uhabits/releases/tag/v2.0.0-alpha">v2.0.0</a>. Previously you could only track habits in a boolean way. Now instead of a checkbox per day, you had a numeric input to track how many times per day you did something.</p>

<p>I had lots of habits in the old boolean format that would benefit from the new format. E.g. I was tracking my coffee and alcohol consumption using days per week, rather than number of units per week. I looked around, but couldn’t find a way to convert between the habit types. I found <a href="https://github.com/iSoron/uhabits/discussions/934">this feature request</a>, but no replies yet. I had a quick look through the codebase, and realized it’d be a lot of work to make a pr since I didn’t know the main language, kotlin. So I decided to try and make my own little utility to convert between the habit types.</p>

<p>I know uhabits supports importing / exporting it’s internal sqlite database. I don’t know kotlin, but I do now SQL, so instead of trying to figure out the logic from the sourcecode, I created a few habits with the new numeric type, and exported everything. I opened up the exported db and compared the differences between the old and new habits.</p>

<h3 id="reverse-engineering-the-datamodel">Reverse engineering the datamodel</h3>
<p>I could see the tables and fields pretty easily, but that didn’t tell me what they were actually used for. I figured out that the habits and repetitions tables were what I needed to work on, because the others were either empty (events), or metadata tables (android_metadata, sqlite_sequence).
<img src="https://conorsheehan1.github.io/assets/images/uhabits/tables.png" alt="tables" />
<img src="https://conorsheehan1.github.io/assets/images/uhabits/table_schema.png" alt="table_schema" /></p>

<p>I needed to start messing with the data to see what would happen. I started with the habits table. 
<img src="https://conorsheehan1.github.io/assets/images/uhabits/habit_data.png" alt="habit_data" />
I noticed <code class="language-plaintext highlighter-rouge">type</code> is 0 for boolean habits and 1 for numeric habits. <code class="language-plaintext highlighter-rouge">freq_num</code> only changes for boolean habits. For numeric habits, it’s always 1. That makes sense since <code class="language-plaintext highlighter-rouge">target_value</code> is generally 0 for boolean habits, but can be any number for numeric habits. <code class="language-plaintext highlighter-rouge">freq_den</code> seems to refer to the time unit. e.g. If I make a boolean habit with a target of 5 times per week I’d get the following for each type:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// boolean, aim to do something 5 days every 7 days</span>
<span class="p">{</span><span class="nl">freq_den</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="nx">freq_num</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">target_value</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">type</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1">// numeric, aim to do something 5 times every 7 days</span>
<span class="p">{</span><span class="na">freq_den</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="na">freq_num</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">target_value</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</code></pre></div></div>

<p>Next I looked at the <code class="language-plaintext highlighter-rouge">repetitions</code> table. I noticed boolean habits generally got a value of 2 when checked, while numeric habits went up in multiples of <code class="language-plaintext highlighter-rouge">1000</code>. It looks like 1000 is used to represent 1.00, so decimals can be added too. e.g. 1.5 would be 1500.
<img src="https://conorsheehan1.github.io/assets/images/uhabits/repetitions_data.png" alt="repetitions_data" /></p>

<p>Once I had identified the differences between habit types in the 2 main tables, I was able to create some python functions to convert from the old boolean type to the new numeric type.</p>

<p>After converting and re-importing my habits, I noticed that the graphs for boolean and numeric habits didn’t quite match. I decided to add 2 options; 1 to try to preserve the graphs, and another to preserve the data the way uhabits would generate it.</p>

<h3 id="creating-a-cli-to-convert-between-types">Creating a CLI to convert between types</h3>
<p>After I was confident my converter worked, I made a little CLI layer to call it from, and published it on github. <a href="https://github.com/ConorSheehan1/uhabits_converter">https://github.com/ConorSheehan1/uhabits_converter</a></p>

<p>The end results look like this:</p>

<table>
  <thead>
    <tr>
      <th>Before</th>
      <th>After</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="https://conorsheehan1.github.io/assets/images/uhabits/coffee_bool.jpg" width="500" height="600" alt="coffee_bool" /></td>
      <td><img src="https://conorsheehan1.github.io/assets/images/uhabits/coffee_num.jpg" width="500" height="600" alt="coffee_num" /></td>
    </tr>
  </tbody>
</table>


      </section>
    </div>
    <footer id="footer">
  <div class="container">
    
    <div id="credit-footer">
      <a href="https://conorsheehan1.github.io/credits"> Credits </a>
    </div>
    <div id="rss-footer">
      <a href="https://conorsheehan1.github.io/feed.xml">
        <i class="fa-solid fa-rss" aria-hidden="true"></i>
      </a>
    </div>
  </div>
</footer>

    <script src="https://conorsheehan1.github.io/assets/dist/jstree/jstree.min.js"></script>
  </body>
</html>
